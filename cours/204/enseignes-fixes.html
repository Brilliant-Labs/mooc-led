<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="nico" />
  <meta name="author" content="Pierre-Yves Rochat, EPFL" />
  <title>Enseignes à motifs fixes</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link rel="stylesheet" href="../../statiques/style.css" type="text/css" />
</head>
<body>
<h1 class="title">Enseignes à motifs fixes</h1>
<div id="header">
<p class="author"><a href="&#x6d;&#x61;&#x69;&#108;&#116;&#x6f;&#58;&#112;&#x79;&#114;&#64;&#112;&#x79;&#114;&#46;&#x63;&#104;" class="email">&#80;&#x69;&#x65;&#114;&#114;&#x65;&#x2d;&#x59;&#118;&#x65;&#x73;&#32;&#82;&#x6f;&#x63;&#104;&#x61;&#116;</a>, EPFL</p>
<p class="date">rév 2015/09/15</p>
</div>
<h2 id="placer-des-led-fixes-pour-former-une-enseigne">Placer des LED fixes pour former une enseigne</h2>
<p>Une des applications les plus simples des LED est la réalisation d’enseignes à motifs fixes. La disponibilité de LED rouges, vertes, bleues, oranges et blanches, pour ne citer que les plus courantes, permet de réaliser des enseignes multicolores.</p>
<p>Voici deux exemples très simples :</p>
<div class="figure">
<img src="images/hotel.png" title="Exemple d’enseigne à motifs fixes" alt="Figure : Exemple d’enseigne à motifs fixes" width="377" />
<p class="caption">Figure : Exemple d’enseigne à motifs fixes</p>
</div>
<div class="figure">
<img src="images/croix-pharma.png" title="Autre exemple" alt="Figure : Autre exemple" width="264" />
<p class="caption">Figure : Autre exemple</p>
</div>
<p>La première enseigne affiche un mot lisible : HOTEL. Ce mot ne peut être changé, car les LED sont disposées de façon à former le mot HOTEL. La seconde enseigne affiche un motif géométrique qui fait penser à une croix de pharmacie.</p>
<p>On peut construire de telles enseignes en fixant des LED sur des panneaux par exemple en plexiglas. En allumant les LED, on produit un effet lumineux qui attire le regard et qui de plus est visible de nuit. En fait, plus l’intensité de la lumière ambiante est faible, mieux l’enseigne se verra.</p>
<h2 id="découper-le-motif-en-segments">Découper le motif en segments</h2>
<p>Mais on peut aller plus loin en découpant les motifs en différentes parties. Le terme “segment” sera souvent utilisé, bien que chaque partie n’a pas forcément la forme d’un segment de droite. Il est alors possible de commander chaque segment individuellement. On programmera alors des animations qui attirent l’œil, telles que des clignotements, des chenillards et même des variations continues d’intensité par PWM. Ce sujet sera abordé plus tard dans ce cours.</p>
<p>Voici comment l’enseigne de pharmacie peut être découpée en segments :</p>
<div class="figure">
<img src="images/croix-pharma-seg.png" title="Découpage du motif en segments" alt="Figure : Découpage du motif en segments" width="264" />
<p class="caption">Figure : Découpage du motif en segments</p>
</div>
<p>Il y a neuf segments dans cet exemple, huit verts et un rouge.</p>
<h2 id="schéma-avec-un-transistor">Schéma avec un transistor</h2>
<p>Comment connecter ensemble un grand nombre de LED pour que les motifs formés puissent être commandés facilement, par exemple par un microcontrôleur ?</p>
<p>Le courant consommé par une LED standard est d’environ 10 mA, bien qu’il existe aussi des LED beaucoup plus puissantes, plutôt utilisées pour l’éclairage. Les sorties des circuits intégrés logiques et des microcontrôleurs permettent en général de fournir quelques dizaines de milliampères, soit un courant suffisant pour une ou deux LED. Pour davantage de LED, un transistor bipolaire ou MOS sera utilisé.</p>
<p>Voici le schéma utilisé, comportant un transistor NPN :</p>
<div class="figure">
<img src="images/transistor-res-leds-50dpi.png" title="Transistor commandant plusieurs LED" alt="Figure : Transistor commandant plusieurs LED" width="302" />
<p class="caption">Figure : Transistor commandant plusieurs LED</p>
</div>
<p>Une sortie du microcontrôleur va commander la base du transistor à travers une résistance. Lorsque la sortie est à l’état 0, aucun courant ne peut circuler dans la base du transistor, qui est alors bloqué : aucun courant ne peut circuler entre le collecteur et l’émetteur, toutes les LED seront donc éteintes.</p>
<p>La valeur de la résistance de base sera déterminée de telle manière à être certain que le transistor soit saturé lorsque la sortie du microcontrôleur est à l’état logique 1. Il faut tenir compte de la tension de la sortie à l’état 1, souvent 3.3 V ou 5 V, selon la tension d’alimentation du microcontrôleur. Il faut lui soustraire la tension base-émetteur du transistor, qui est de 0.7 V. On s’assurera ensuite que le courant de base soit supérieur au courant de collecteur divisé par le facteur d’amplification du transistor.</p>
<p>Même si elles sont regroupées en un seul motif, commandé par une seule sortie d’un microcontrôleur, il est toujours nécessaire de placer une résistance de limitation de courant pour chaque LED. Il est fortement déconseillé de n’utiliser qu’une seule résistance en série avec plusieurs LED reliées en parallèle, car cette façon de faire ne permet pas d’ajuster le courant consommé par chacune des LED, donc la luminosité de l’afficheur ne sera pas constante. Ceci est dû au fait qu’il y a des dispersions importantes dans les caractéristiques des LED, même si elles sont du même fabricant et de la même série de production.</p>
<h2 id="placer-plusieurs-led-en-série">Placer plusieurs LED en série</h2>
<p>Il est possible d’augmenter la tension d’alimentation et de placer plusieurs LED en série pour une seule résistance de limitation. Le courant est exactement le même dans chaque LED d’une branche !</p>
<p>Ce schéma montre comment commander plusieurs LED en série avec un transistor, avec une ou plusieurs branches :</p>
<div class="figure">
<img src="images/transistor-serie-led-40dpi.png" title="Utilisation de plusieurs LED en série" alt="Figure : Utilisation de plusieurs LED en série" width="264" />
<p class="caption">Figure : Utilisation de plusieurs LED en série</p>
</div>
<p>Il faut connaître la tension de chaque LED pour choisir le nombre optimal de LED dans chaque branche. Les LED rouges ont en général une tension d’environ 2 V, alors que les vertes ou les bleues ont plutôt 3 V. Mais il existe plusieurs technologies pour produire des LED et il faut bien se renseigner concernant les LED choisies... ou simplement les mesurer !</p>
<p>Avec une tension d’alimentation de 12 V, on peut alimenter par exemple 5 LED rouges ou 3 LED vertes. Notez qu’avec un seul transistor faible signal, il est possible de commander un grand nombre de LED. Par exemple, un BC337, dont le courant maximal est d’environ 500 mA (cette valeur varie selon les fabricants) permet de commander jusqu’à environ 250 LED rouges avec cette technique : chaque groupe de 5 LED en série reçoit 10 mA et il est possible de placer 50 branches.</p>
<p>Prenons un autre exemple. Avec une alimentation de PC portable, fournissant 16 V et un maximum de 4.5 A, combien de LED vertes est-il possible de commander ? La tension aux bornes de chaque LED doit être d’environ 3 V, pour un courant de 10 mA.</p>
<p>Voici la réponse : on peut mettre 5 LED en série (15 V) avec une résistance de limitation. Il est possible de placer 450 groupes de LED <code>(450 × 10 mA = 4.5 A)</code>. C’est donc un total de 2’250 LED qu’il est possible de commander !</p>
<p>Dans ce cas, voici comment calculer la valeur de la résistance série : les 5 LED présentent une différence de potentiel de 3 V à leurs bornes. Il reste <code>16 – (5 × 3) = 1 V</code> aux bornes de la résistance. Pour un courant nominal, il faut <code>R = U / I = 1 V / 10 mA = 100 Ω</code>.</p>
<p>En pratique, on réalisera un montage de test avec les 5 LED et une résistance, sans oublier le transistor, qui a aussi une chute de tension. On mesurera la tension aux bornes de la résistance, on calculera le courant qui la traverse <code>(I = U / R)</code>. On corrigera ensuite la valeur de la résistance pour se rapprocher du courant souhaité (par exemple 10 mA) et on reprendra le test.</p>
<p>Il est même possible de commander un segment contenant des LED de plusieurs couleurs. Voici un schéma correspondant :</p>
<div class="figure">
<img src="images/transistor-3-5led-30dpi.png" title="Utilisation simultanée de plusieurs types de LED" alt="Figure : Utilisation simultanée de plusieurs types de LED" width="340" />
<p class="caption">Figure : Utilisation simultanée de plusieurs types de LED</p>
</div>
<h2 id="courants-importants">Courants importants</h2>
<p>Ce type de montage peut nécessiter des courants d’alimentation importants. Lorsque des milliers de LED sont utilisées pour un seul segment, il faudra utiliser un transistor correctement dimensionné.</p>
<p>Il faudra aussi réaliser un câblage électrique adapté : la section de cuivre du fil ou du câble utilisé devra être choisie correctement. Si le fil est long, la chute de tension peut devenir non négligeable, et donc influencer le courant dans les LED et par conséquent leur luminosité.</p>
<p>Comme il y a en général un nombre important de segments, ce sont surtout les courants dans les conducteurs d’alimentation qui peuvent devenir importants. C’est le cas du câblage qui apporte la tension positive sur les anodes des transistors. Mais c’est tout autant le cas dans les câblages de la masse.</p>
<p>La figure suivante montre l’importance des courants :</p>
<div class="figure">
<img src="images/transistor-courants.png" title="Courants dans les fils des segments" alt="Figure : Courants dans les fils des segments" width="566" />
<p class="caption">Figure : Courants dans les fils des segments</p>
</div>
<h2 id="programmation-danimations">Programmation d’animations</h2>
<p>Le premier programme souvent proposé pour apprendre à mettre en œuvre un microcontrôleur, le fameux <em>blink</em> est déjà un programme d’animation d’une enseigne, avec une seule sortie ! Fondamentalement, il est facile d’écrire une animation. Il faut écrire les instructions pour mettre les sorties dans un certain état, puis attendre un certain temps. L’animation va comporter un certain nombre de ces paires d’instructions et tournera en boucle. Prenons un exemple très simple, qui produit une animation du type <em>chenillard</em> :</p>
<div class="sourceCode" startFrom="1"><table class="sourceCode c numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="sourceCode"><pre><code class="sourceCode c"><span class="dt">void</span> setup() {
  P2DIR |= <span class="bn">0xFF</span>; <span class="co">// P2.0 à P2.7 en sortie</span>
}

<span class="dt">void</span> loop() { <span class="co">// Boucle infinie, correspond à toute l&#39;animation</span>
  P2OUT  = <span class="dv">0</span>;                  <span class="co">// éteint toutes les LED</span>
  P2OUT |= (<span class="dv">1</span>&lt;&lt;<span class="dv">0</span>); delay(<span class="dv">200</span>); <span class="co">// allume la première LED</span>
  P2OUT |= (<span class="dv">1</span>&lt;&lt;<span class="dv">1</span>); delay(<span class="dv">200</span>); <span class="co">// allume successivement chaque LED...</span>
  P2OUT |= (<span class="dv">1</span>&lt;&lt;<span class="dv">2</span>); delay(<span class="dv">200</span>);
  P2OUT |= (<span class="dv">1</span>&lt;&lt;<span class="dv">3</span>); delay(<span class="dv">200</span>);
  P2OUT |= (<span class="dv">1</span>&lt;&lt;<span class="dv">4</span>); delay(<span class="dv">200</span>);
  P2OUT |= (<span class="dv">1</span>&lt;&lt;<span class="dv">5</span>); delay(<span class="dv">200</span>);
  P2OUT |= (<span class="dv">1</span>&lt;&lt;<span class="dv">6</span>); delay(<span class="dv">200</span>);
  P2OUT |= (<span class="dv">1</span>&lt;&lt;<span class="dv">7</span>); delay(<span class="dv">1000</span>);<span class="co">// attend un peu après la dernière LED</span>
  P2OUT  = <span class="dv">0</span>;      delay(<span class="dv">500</span>); <span class="co">// éteint toutes les LED pendant 1/2 seconde</span>
  P2OUT  = <span class="bn">0xFF</span>;   delay(<span class="dv">500</span>); <span class="co">// allume toutes les LED</span>
  P2OUT  = <span class="dv">0</span>;      delay(<span class="dv">500</span>); <span class="co">// répète...</span>
  P2OUT  = <span class="bn">0xFF</span>;   delay(<span class="dv">1000</span>);
  P2OUT  = <span class="dv">0</span>;      delay(<span class="dv">500</span>); <span class="co">// pause avant la reprise de l&#39;animation</span>
}</code></pre></td></tr></table></div>
<!-- retour au mode normal pour l'éditeur -->
<p>On aurait pu utiliser uniquement des procédures <code>pinMode()</code> pour l’initialisation et <code>digitalWrite()</code> pour les animations. Dans un cas comme dans l’autre, le style de ce programme n’est pas un modèle du genre et a donc nécessité de nombreux commentaires. Or <em>un programme bien écrit ne nécessite pas beaucoup de commentaires</em>, alors qu’on voudrait souvent vous faire croire que plus un programme comporte de commentaires, mieux il est écrit !</p>
<p>L’utilisation de définitions comme :</p>
<div class="sourceCode"><pre class="sourceCode c"><code class="sourceCode c"><span class="ot">#define Led1ON P2OUT |= (1&lt;&lt;0)</span>
<span class="ot">#define Led1OFF P2OUT &amp;=~(1&lt;&lt;0)</span></code></pre></div>
<!-- retour au mode normal pour l'éditeur -->
<p>rendrait le code plus lisible.</p>
<p>Mais le fait d’utiliser l’accès aux sorties par le registre <code>P2OUT</code> permet de programmer plus simplement la fonction du chenillard :</p>
<div class="sourceCode" startFrom="1"><table class="sourceCode c numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="sourceCode"><pre><code class="sourceCode c"><span class="dt">void</span> ChenillardAjoute(<span class="dt">uint16_t</span> attente) {
  unit16_t i;
  <span class="kw">for</span> (i=<span class="dv">0</span>; i&lt;<span class="dv">8</span>; i++) {
    P2OUT |=(<span class="dv">1</span>&lt;&lt;i);
    delay(attente);
  }
}
...
<span class="dt">void</span> loop() { <span class="co">// Boucle infinie, correspond à toute l&#39;animation</span>
  ChenillardAjoute(<span class="dv">200</span>);
  delay(<span class="dv">800</span>); <span class="co">// attend un peu après la dernière LED</span>
  P2OUT = <span class="dv">0</span>; delay(<span class="dv">500</span>); <span class="co">// éteint toutes les LED pendant 1/2 seconde</span>
  ...
}</code></pre></td></tr></table></div>
<!-- retour au mode normal pour l'éditeur -->
<p>On pourrait aussi écrire une fonction chenillard encore plus générale, avec en paramètres non seulement le temps d’attente, mais le sens du mouvement et le fait de garder ou non les LED précédentes allumées.</p>
<p>Que vois-je ? Ai-je écrit le mot <em>mouvement</em> ? Est-ce que les LED bougent ? C’est toute la magie des LED... Elles ne bougent pas, mais peuvent donner l’impression de mouvement.</p>
</body>
</html>